(this["webpackJsonpcowin-notif"]=this["webpackJsonpcowin-notif"]||[]).push([[0],{183:function(t,e,n){},185:function(t,e,n){},207:function(t,e){},209:function(t,e){},219:function(t,e){},221:function(t,e){},248:function(t,e){},249:function(t,e){},254:function(t,e){},256:function(t,e){},263:function(t,e){},282:function(t,e){},323:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(65),o=n.n(c),r=(n(183),n(30)),s=n.n(r),l=n(49),u=n(66),h=n(67),f=n(177),d=n(175),p=(n(185),n(329)),v=n(332),b=n(333),g=n(331),j=n(174),y=n(334),m=n(57),O=n.n(m),x=n(328),w=n(99),k=n.n(w),S=function(){function t(){Object(u.a)(this,t)}return Object(h.a)(t,[{key:"req",value:function(t){return new Promise((function(e,n){O.a.get(t).then((function(t){return e(t.data)})).catch((function(t){return n(t)}))}))}},{key:"init",value:function(t,e){var n=this;return new x.a((function(i){var a=n.req.bind(n);n.watcher=setInterval((function(){a("".concat("https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/calendarByPin","?pincode=").concat(t,"&date=").concat(e)).then((function(t){i.next(t)})).catch((function(t){i.error(t)}))}),500)}))}},{key:"clearWatch",value:function(){console.log(this),clearInterval(this.watcher)}},{key:"generateOtp",value:function(){var t=Object(l.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.post("https://cdn-api.co-vin.in/api/v2/auth/generateMobileOTP",{mobile:e,secret:"U2FsdGVkX19mD56KTNfQsZgXJMwOG7u/6tuj0Qvil1LEjx783oxHXGUTDWYm+XMYVGXPeu+a24sl5ndEKcLTUQ=="}).then((function(t){return t.data})).catch((function(t){console.log(t)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"verifyOtp",value:function(){var t=Object(l.a)(s.a.mark((function t(e,n){var i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=k.a.SHA256(e).toString(k.a.enc.Hex),t.next=3,O.a.post("https://cdn-api.co-vin.in/api/v2/auth/validateMobileOtp",{body:JSON.stringify({otp:i,txnId:n}),headers:{"content-type":"application/json"},method:"POST",mode:"cors",credentials:"omit"}).then((function(t){return t.data})).catch((function(t){return console.log(t)}));case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getBenefeciaries",value:function(){var t=Object(l.a)(s.a.mark((function t(e){return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,O.a.get("https://cdn-api.co-vin.in/api/v2/appointment/beneficiaries",{headers:{"content-type":"application/json",authorization:"Bearer ".concat(e)}}).then((function(t){return t.data})).catch((function(t){return t}));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"trackAuth",value:function(t){var e=this;return new x.a((function(n){var i=e.getBenefeciaries.bind(e);e.watcher=setInterval((function(){i(t).then((function(t){n.next(t)})).catch((function(t){n.error(t)}))}),18e4)}))}}]),t}(),A=n(164),W=n.n(A),C=n(7);console.log("asdad");var N=new S,T=p.a.Search,P=function(t){Object(f.a)(n,t);var e=Object(d.a)(n);function n(t){var i;return Object(u.a)(this,n),(i=e.call(this,t)).state={isWatchingAvailability:!1,isAuthenticated:!1,minAge:18,beneficiaries:[],vaccineCalendar:{},zip:null,enableOtp:!1,mobile:null,dates:[]},i}return Object(h.a)(n,[{key:"waitForOtp",value:function(){var t=Object(l.a)(s.a.mark((function t(){var e,n=this;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("waiting for otp"),this.ac&&this.ac.abort(),!("OTPCredential"in window)){t.next=17;break}return console.log("Waiting for SMS. Try sending yourself a following message:\n\nYour verification code is: 123ABC\n\n@whatwebcando.today #123ABC"),t.prev=4,this.ac=new AbortController,t.next=8,navigator.credentials.get({otp:{transport:["sms"]},signal:this.ac.signal}).then((function(t){console.log("otp is ",t),console.log("otp, ".concat(t)),n.setState({otp:t})})).catch((function(t){console.log("ssss ".concat(t))}));case 8:e=t.sent,console.log(e),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(4),console.log(t.t0);case 15:t.next=18;break;case 17:console.log("Web OTP API not supported");case 18:case"end":return t.stop()}}),t,this,[[4,12]])})));return function(){return t.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){Notification.requestPermission((function(t){console.log("Notification permission status:",t)})),this.notifSound=document.getElementById("notif"),this.notifSound.play();var t={title:"Vaccine Notifications Enabled",body:"You now have notifications active for Covid vaccine availability",native:!0,vibrate:[300,100,400]};try{Notification.requestPermission((function(e){"granted"===e&&navigator.serviceWorker.ready.then((function(e){e.showNotification(t.title,t)}))})),new Notification(t.title,t)}catch(e){console.log(e)}}},{key:"setStorage",value:function(){var t=Object.assign({},this.state);delete t.vaccineCalendar,delete t.isWatchingAvailability,localStorage.appData=JSON.stringify(t)}},{key:"componentWillUnmount",value:function(){this.watcher&&this.watcher.unsubscribe()}},{key:"handleNotification",value:function(){var t=this;this.state.vaccineCalendar.centers.map((function(e){e.sessions.map((function(n){if(parseInt(n.min_age_limit)==t.state.minAge&&parseInt(n.available_capacity)>0){t.setState({enableOtp:!0}),t.notifSound.play();var i={title:e.name,body:"".concat(e.pincode," ").concat(e.address," has ").concat(n.available_capacity," on ").concat(n.date),vibrate:[300,100,400],native:!0};Notification.requestPermission((function(t){"granted"===t&&navigator.serviceWorker.ready.then((function(t){t.showNotification(i.message,i)}))})),new Notification(i.title,i)}}))}))}},{key:"initWatch",value:function(t){var e=this;console.log("zip",e.zip),this.watcher=N.init(this.state.zip,W()().format("DD-MM-YYYY")).subscribe({next:function(t){e.setState({vaccineCalendar:t},(function(){e.handleNotification(),e.setStorage()}))},error:function(t){console.error("something wrong occurred: "+t)},complete:function(){console.log("done"),this.setState({isWatchingAvailability:!1})}})}},{key:"trackAuth",value:function(){var t=this;this.watcher=N.trackAuth(this.state.token).subscribe({next:function(e){t.setState({beneficiaries:e})},error:function(t){console.error("something wrong occurred: "+t),this.setState({isAuthenticated:!1})},complete:function(){console.log("done"),this.setState({isWatchingAvailability:!1})}})}},{key:"clearWatch",value:function(){N.clearWatch(),this.setState({isWatchingAvailability:!1})}},{key:"renderTable",value:function(t){return Object(C.jsx)("table",{style:{marginTop:10},children:t.centers.map((function(t){var e=!0;return t.sessions.map((function(t){t.available_capacity>0&&(e=!1)})),Object(C.jsxs)("tr",{children:[Object(C.jsxs)("td",{children:[Object(C.jsxs)("h3",{children:[t.pincode," ",t.name]}),t.block_name,t.address]}),e?Object(C.jsx)("td",{children:"No Availability"}):t.sessions.map((function(t){return Object(C.jsxs)("td",{children:[Object(C.jsx)("h4",{children:t.date}),Object(C.jsx)("p",{children:t.vaccine}),Object(C.jsx)("div",{children:parseInt(t.available_capacity)>0?"".concat(t.available_capacity," shots available for ").concat(t.min_age_limit,"+"):"No Availability"}),parseInt(t.available_capacity>0)?Object(C.jsxs)("div",{children:[Object(C.jsx)("b",{children:"Available Slots"}),t.slots.map((function(t){return Object(C.jsx)(v.a,{children:t})}))]}):null]},t.session_id)}))]},t.center_id)}))})}},{key:"setMinAge",value:function(t){this.setState({minAge:t.target.value})}},{key:"generateOtp",value:function(){this.setState({enableOtp:!0})}},{key:"verifyOtp",value:function(){var t=this;this.setState({enableOtp:!1}),N.verifyOtp(this.state.otp,this.state.otpData.txnId).then((function(e){t.setState({token:e.token,isAuthenticated:!0},(function(){t.trackAuth()}))})).catch((function(e){console.log(e),t.generateOtp()}))}},{key:"render",value:function(){var t=this,e=this.state.vaccineCalendar;return Object(C.jsxs)("div",{className:"App",children:[Object(C.jsx)("audio",{id:"notif",children:Object(C.jsx)("source",{src:"https://assets.coderrocketfuel.com/pomodoro-times-up.mp3"})}),Object(C.jsx)("header",{className:"App-header",children:Object(C.jsx)("h2",{children:"Get notifications for Covid-19 vaccine availability in your area"})}),Object(C.jsx)("a",{href:"https://www.cowin.gov.in/home",target:"_blank",children:"Visit Cowin to book a Vaccination Slot"}),Object(C.jsxs)(b.a,{style:{marginBottom:10},children:[this.state.isWatchingAvailability?null:Object(C.jsx)("h3",{children:"Select age group for getting notifications"}),Object(C.jsxs)(g.a.Group,{onChange:this.setMinAge.bind(this),value:this.state.minAge,disabled:this.state.isWatchingAvailability,children:[Object(C.jsx)(g.a,{value:18,children:"18 to 45 Years"}),Object(C.jsx)(g.a,{value:45,children:"45+ Years"})]})]}),Object(C.jsxs)(v.a,{gutter:{xs:8,sm:16,md:24,lg:32},children:[this.state.isAuthenticated?null:Object(C.jsxs)(b.a,{children:[this.state.enableOtp?Object(C.jsx)(T,{placeholder:"Enter OTP",allowClear:!0,type:"number",enterButton:"Submit",size:"large",onSearch:function(e){console.log(e),t.setState({otp:e},(function(){t.verifyOtp()}))}}):Object(C.jsx)(T,{placeholder:"Mobile Number",allowClear:!0,type:"number",value:this.state.mobile,enterButton:"Generate OTP",size:"large",onSearch:function(e){t.setState({mobile:e,enableOtp:!0})}}),Object(C.jsx)(T,{disabled:this.state.isWatchingAvailability,placeholder:this.state.zip?this.state.zip:"Enter your area pincode",allowClear:!0,type:"number",enterButton:this.state.isWatchingAvailability?"Tracking":"Track Availability",size:"large",loading:this.state.isWatchingAvailability,onSearch:function(e){t.setState({zip:e,isWatchingAvailability:!0},(function(){t.initWatch()}))}})]}),Object(C.jsx)(b.a,{children:this.state.isWatchingAvailability?Object(C.jsx)(j.a,{type:"primary",icon:Object(C.jsx)(y.a,{}),size:"large",danger:!0,onClick:this.clearWatch.bind(this),children:"Stop"}):null})]}),e&&e.centers?this.renderTable(e):null]})}}]),n}(a.a.Component),B=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,335)).then((function(e){var n=e.getCLS,i=e.getFID,a=e.getFCP,c=e.getLCP,o=e.getTTFB;n(t),i(t),a(t),c(t),o(t)}))};o.a.render(Object(C.jsx)(a.a.StrictMode,{children:Object(C.jsx)(P,{})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)})),B()}},[[323,1,2]]]);
//# sourceMappingURL=main.cf82de2d.chunk.js.map